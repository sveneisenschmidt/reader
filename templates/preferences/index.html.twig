{% extends 'base.html.twig' %}

{% block title %}Preferences | Reader{% endblock %}

{% block preload %}
    <link rel="preload" href="{{ asset('css/shared-layout.css') }}" as="style">
    <link rel="preload" href="{{ asset('css/shared-forms.css') }}" as="style">
    <link rel="preload" href="{{ asset('css/page-preferences.css') }}" as="style">
{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/shared-layout.css') }}">
    <link rel="stylesheet" href="{{ asset('css/shared-forms.css') }}">
    <link rel="stylesheet" href="{{ asset('css/page-preferences.css') }}">
{% endblock %}

{% block page_id %}preferences{% endblock %}

{% block page_class %} class="page-container"{% endblock %}

{% block main %}

    {% for message in app.flashes('success') %}
        <p class="flash-success">{{ message }}</p>
    {% endfor %}

    {{ form_start(profileForm, {'attr': {'class': 'form', 'novalidate': 'novalidate'}}) }}
    <section class="page-section">
        <h2>Profile</h2>
        <div class="form-row">
            {{ form_row(profileForm.username) }}
            <p>Your email ({{ email }}) can not be changed.</p>
        </div>
        <div class="form-links">
            <a href="#">Update Password →</a>
            <a href="#">Update Authentication →</a>
        </div>
        <div class="form-actions">
            {{ form_widget(profileForm.save) }}
        </div>
    </section>
    {{ form_end(profileForm, {'render_rest': false}) }}

    {{ form_start(preferencesForm, {'attr': {'class': 'form', 'novalidate': 'novalidate'}}) }}
    <section class="page-section">
        <h2>Preferences</h2>
        <div class="form-row">
            {{ form_row(preferencesForm.theme) }}
        </div>
        <div class="form-row">
            <div class="form-checkbox">
                {{ form_widget(preferencesForm.showNextUnread) }}
                <div class="form-checkbox__content">
                    {{ form_label(preferencesForm.showNextUnread) }}
                    <p>When disabled, you'll continue to the next article in the list.</p>
                </div>
            </div>
        </div>
        <div class="form-row">
            <div class="form-checkbox">
                {{ form_widget(preferencesForm.pullToRefresh) }}
                <div class="form-checkbox__content">
                    {{ form_label(preferencesForm.pullToRefresh) }}
                    <p>When disabled, you can only refresh using the button in the footer.</p>
                </div>
            </div>
        </div>
        <div class="form-actions">
            {{ form_widget(preferencesForm.save) }}
        </div>
    </section>
    {{ form_end(preferencesForm, {'render_rest': false}) }}

    <section class="page-section">
        <h2>Status</h2>
        <p>
            {% if workerAlive %}
                <span class="status-online">●</span> Worker online ({{ workerLastBeat|ago }})
            {% elseif workerLastBeat %}
                <span class="status-offline">●</span> Worker offline ({{ workerLastBeat|ago }})
            {% else %}
                <span class="status-offline">●</span> Worker offline
            {% endif %}
        </p>
        <p>
            {% if webhookAlive %}
                <span class="status-online">●</span> Webhook online ({{ webhookLastBeat|ago }})
            {% elseif webhookLastBeat %}
                <span class="status-offline">●</span> Webhook offline ({{ webhookLastBeat|ago }})
            {% else %}
                <span class="status-offline">●</span> Webhook offline
            {% endif %}
        </p>
        <div class="form-links">
            <a href="{{ path('status') }}">View detailed status →</a>
        </div>
    </section>

    <section class="page-section section-logout">
        <a href="{{ path('auth_logout') }}" class="btn-secondary">Logout</a>
    </section>

{% endblock %}
