{% extends 'base.html.twig' %}

{% block title %}Subscriptions | Reader{% endblock %}

{% block stylesheets %}
    <style>
        {{ asset_inline('css/shared-layout.css') }}
        {{ asset_inline('css/shared-forms.css') }}
        {{ asset_inline('css/page-subscriptions.css') }}
    </style>
{% endblock %}

{% block header_actions %}
    <span>Subscriptions</span>
{% endblock %}

{% block page_id %}subscriptions{% endblock %}

{% block page_class %} class="page-container"{% endblock %}

{% block main %}

    {% for message in app.flashes('success') %}
        <p class="flash-success">{{ message }}</p>
    {% endfor %}

    {{ form_start(form, {'attr': {'class': 'form', 'novalidate': 'novalidate', 'enctype': 'multipart/form-data'}}) }}

    <section class="page-section">
        <h2>Add Subscription</h2>
        {{ form_widget(form.new.guid, {'attr': {'hidden': true}}) }}
        {{ form_widget(form.new.name, {'attr': {'hidden': true}}) }}
        <div class="form-row">
            <label>URL</label>
            <div class="form-inline">
                {{ form_widget(form.new.url) }}
                {{ form_widget(form.add) }}
            </div>
            {{ form_errors(form.new.url) }}
            <p>Enter a website or feed URL. Feeds are auto-discovered from websites.</p>
        </div>
    </section>

    {% if form.existing|length > 0 %}
    <section class="page-section page-section--bordered">
        <h2>Manage Subscriptions</h2>

        {% for subscription in form.existing %}
        <details class="subscription-item">
            <summary class="subscription-item__summary">
                {{ subscription.name.vars.value }}
            </summary>

            {{ form_widget(subscription.guid) }}
            {{ form_widget(subscription.url, {'attr': {'hidden': true}}) }}

            <div class="subscription-item__content">
                <div class="form-row">
                    <a href="{{ subscription.url.vars.value }}" target="_blank" rel="noopener" class="subscription-item__url">{{ subscription.url.vars.value }}</a>
                </div>

                <div class="form-row form-row--two-columns">
                    <div>
                        <label>Name</label>
                        {{ form_widget(subscription.name) }}
                        <p>Display name in your feed list.</p>
                    </div>
                    <div>
                        <label>Folder</label>
                        {{ form_widget(subscription.folder) }}
                        <p>Group feeds together.</p>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-checkbox">
                        {{ form_widget(subscription.useArchiveIs) }}
                        <div class="form-checkbox__content">
                            {{ form_label(subscription.useArchiveIs) }}
                            <p>Use archived versions instead of original links.</p>
                        </div>
                    </div>
                </div>

                <div class="form-row form-actions form-actions--space-between">
                    {{ form_widget(subscription.save) }}
                    {{ form_widget(subscription.remove, {'attr': {'class': 'btn-secondary'}}) }}
                </div>
            </div>
        </details>
        {% endfor %}
    </section>
    {% endif %}

    <section class="page-section">
        <h2>Import / Export</h2>

        <div class="form-row">
            {{ form_label(form.opml) }}
            <div class="form-inline">
                {{ form_widget(form.opml, {'attr': {'accept': '.opml,.xml'}}) }}
                {{ form_widget(form.import) }}
            </div>
            {{ form_errors(form.opml) }}
            <p>Import subscriptions from an OPML file.</p>
        </div>

        {% for message in app.flashes('error') %}
            <p class="flash-error">{{ message }}</p>
        {% endfor %}

        <div class="form-links">
            <a href="{{ path('subscription_export') }}">Export Subscriptions â†’</a>
        </div>
    </section>

    {{ form_end(form, {'render_rest': false}) }}
{% endblock %}
